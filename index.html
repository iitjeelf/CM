<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>LFJC Online Examination Platform</title>
<!-- Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
/* ===== METTL-LIKE PROFESSIONAL THEME ===== */
:root {
  --primary-color: #2E5BFF;
  --primary-dark: #1A3DB0;
  --secondary-color: #00C9A7;
  --accent-color: #FF6B6B;
  --success-color: #36B37E;
  --warning-color: #FFAB00;
  --danger-color: #FF5630;
  --info-color: #00B8D9;
  
  --light-bg: #F8F9FC;
  --card-bg: #FFFFFF;
  --border-color: #E6E8F0;
  --text-primary: #2E384D;
  --text-secondary: #6B778C;
  --text-light: #B0BAC9;
  
  --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.08);
  --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.08);
  --shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.12);
  --shadow-xl: 0 16px 48px rgba(0, 0, 0, 0.16);
  
  --radius-sm: 4px;
  --radius-md: 8px;
  --radius-lg: 12px;
  --radius-xl: 16px;
  
  --transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
}

/* ===== GLOBAL RESETS ===== */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  background: var(--light-bg);
  color: var(--text-primary);
  line-height: 1.6;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

/* ===== GITHUB DEPLOYMENT WARNING ===== */
.github-warning {
  position: fixed;
  top: 20px;
  left: 50%;
  transform: translateX(-50%);
  background: linear-gradient(135deg, #ff9800, #ff5722);
  color: white;
  padding: 15px 25px;
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow-xl);
  z-index: 10001;
  max-width: 90%;
  width: 500px;
  text-align: center;
  animation: slideDown 0.5s ease;
}

.github-warning-content {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 15px;
}

.github-warning-text {
  flex: 1;
  text-align: left;
}

.github-warning-text h4 {
  margin-bottom: 5px;
  display: flex;
  align-items: center;
  gap: 10px;
}

.github-warning-text p {
  font-size: 14px;
  opacity: 0.9;
  margin-bottom: 5px;
}

.github-deploy-btn {
  background: white;
  color: #ff5722;
  border: none;
  padding: 8px 15px;
  border-radius: var(--radius-md);
  cursor: pointer;
  font-weight: 600;
  transition: var(--transition);
  white-space: nowrap;
}

.github-deploy-btn:hover {
  background: #f5f5f5;
  transform: translateY(-2px);
}

.github-deploy-btn i {
  margin-right: 5px;
}

/* ===== MICROPHONE TEST MODAL ===== */
.microphone-test-modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.8);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 10000;
  backdrop-filter: blur(10px);
}

.microphone-test-box {
  background: var(--card-bg);
  border-radius: var(--radius-xl);
  width: 90%;
  max-width: 500px;
  padding: 30px;
  box-shadow: var(--shadow-xl);
  animation: slideDown 0.3s ease;
}

@keyframes slideDown {
  from { transform: translateY(-20px); opacity: 0; }
  to { transform: translateY(0); opacity: 1; }
}

.mic-test-header {
  text-align: center;
  margin-bottom: 25px;
}

.mic-test-header h3 {
  color: var(--primary-color);
  margin-bottom: 8px;
}

.mic-test-visualizer {
  width: 100%;
  height: 120px;
  background: #1a1a2e;
  border-radius: var(--radius-md);
  margin: 20px 0;
  position: relative;
  overflow: hidden;
}

.mic-level-indicator {
  position: absolute;
  bottom: 0;
  left: 0;
  width: 100%;
  height: 0%;
  background: linear-gradient(to top, #00C9A7, #36B37E);
  transition: height 0.1s ease;
}

.mic-frequency-canvas {
  width: 100%;
  height: 100%;
}

.mic-test-controls {
  display: flex;
  gap: 10px;
  margin: 20px 0;
}

.mic-test-btn {
  flex: 1;
  padding: 12px;
  border: none;
  border-radius: var(--radius-md);
  font-weight: 600;
  cursor: pointer;
  transition: var(--transition);
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
}

#startMicTest {
  background: var(--success-color);
  color: white;
}

#startMicTest:hover:not(:disabled) {
  background: #2a8f66;
  transform: translateY(-2px);
}

#stopMicTest {
  background: var(--danger-color);
  color: white;
}

#stopMicTest:hover:not(:disabled) {
  background: #d9371c;
  transform: translateY(-2px);
}

.mic-test-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none !important;
}

.mic-volume-display {
  text-align: center;
  font-size: 18px;
  font-weight: 700;
  color: var(--text-primary);
  margin: 15px 0;
}

.mic-volume-level {
  color: var(--success-color);
  font-size: 24px;
}

.mic-troubleshooting {
  background: #FFF3CD;
  border: 1px solid #FFEAA7;
  border-radius: var(--radius-md);
  padding: 15px;
  margin: 20px 0;
}

.mic-troubleshooting h4 {
  color: #856404;
  margin-bottom: 10px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.mic-troubleshooting ul {
  list-style: none;
  padding-left: 5px;
}

.mic-troubleshooting li {
  margin-bottom: 8px;
  padding-left: 20px;
  position: relative;
}

.mic-troubleshooting li:before {
  content: "•";
  color: #856404;
  position: absolute;
  left: 0;
}

.mic-device-list {
  background: var(--light-bg);
  border-radius: var(--radius-md);
  padding: 15px;
  margin: 15px 0;
  max-height: 200px;
  overflow-y: auto;
}

.device-item {
  padding: 10px;
  border-bottom: 1px solid var(--border-color);
  font-size: 14px;
  cursor: pointer;
  transition: var(--transition);
}

.device-item:hover {
  background: rgba(46, 91, 255, 0.05);
}

.device-item:last-child {
  border-bottom: none;
}

.device-label {
  font-weight: 600;
  color: var(--text-primary);
  display: flex;
  align-items: center;
  gap: 8px;
}

.device-id {
  font-size: 12px;
  color: var(--text-secondary);
  word-break: break-all;
  margin-top: 4px;
}

.mic-test-actions {
  display: flex;
  gap: 10px;
  margin-top: 20px;
}

#skipMicTest {
  background: var(--text-light);
  color: var(--text-primary);
}

#retryMicTest {
  background: var(--primary-color);
  color: white;
}

/* ===== CAMERA TEST MODAL ===== */
.camera-test-modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.8);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 10000;
  backdrop-filter: blur(10px);
}

.camera-test-box {
  background: var(--card-bg);
  border-radius: var(--radius-xl);
  width: 90%;
  max-width: 600px;
  padding: 30px;
  box-shadow: var(--shadow-xl);
  animation: slideDown 0.3s ease;
}

.camera-test-header {
  text-align: center;
  margin-bottom: 25px;
}

.camera-test-header h3 {
  color: var(--primary-color);
  margin-bottom: 8px;
}

.camera-preview-container {
  width: 100%;
  height: 300px;
  background: #1a1a2e;
  border-radius: var(--radius-md);
  overflow: hidden;
  margin: 20px 0;
  position: relative;
}

#cameraPreview {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.camera-status {
  position: absolute;
  bottom: 10px;
  left: 10px;
  background: rgba(0, 0, 0, 0.7);
  color: white;
  padding: 5px 10px;
  border-radius: var(--radius-sm);
  font-size: 12px;
}

.camera-controls {
  display: flex;
  gap: 10px;
  margin: 20px 0;
}

.camera-test-btn {
  flex: 1;
  padding: 12px;
  border: none;
  border-radius: var(--radius-md);
  font-weight: 600;
  cursor: pointer;
  transition: var(--transition);
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
}

#startCameraTest {
  background: var(--success-color);
  color: white;
}

#startCameraTest:hover:not(:disabled) {
  background: #2a8f66;
  transform: translateY(-2px);
}

#stopCameraTest {
  background: var(--danger-color);
  color: white;
}

#stopCameraTest:hover:not(:disabled) {
  background: #d9371c;
  transform: translateY(-2px);
}

.camera-device-list {
  background: var(--light-bg);
  border-radius: var(--radius-md);
  padding: 15px;
  margin: 15px 0;
  max-height: 200px;
  overflow-y: auto;
}

.camera-device-item {
  padding: 10px;
  border-bottom: 1px solid var(--border-color);
  font-size: 14px;
  cursor: pointer;
  transition: var(--transition);
}

.camera-device-item:hover {
  background: rgba(46, 91, 255, 0.05);
}

.camera-device-item:last-child {
  border-bottom: none;
}

/* ===== SYSTEM CHECK SCREEN ===== */
#systemCheckScreen {
  display: none;
  min-height: 100vh;
  background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
  padding: 40px 20px;
}

.system-check-container {
  max-width: 600px;
  margin: 0 auto;
  background: var(--card-bg);
  border-radius: var(--radius-xl);
  padding: 40px;
  box-shadow: var(--shadow-xl);
}

.checklist {
  margin: 32px 0;
}

.check-item {
  display: flex;
  align-items: center;
  padding: 16px;
  border: 2px solid var(--border-color);
  border-radius: var(--radius-md);
  margin-bottom: 12px;
  transition: var(--transition);
  cursor: pointer;
}

.check-item:hover {
  border-color: var(--primary-color);
  transform: translateY(-2px);
}

.check-item:last-child {
  margin-bottom: 0;
}

.check-item.passed {
  border-color: var(--success-color);
  background: rgba(54, 179, 126, 0.05);
}

.check-item.failed {
  border-color: var(--danger-color);
  background: rgba(255, 86, 48, 0.05);
}

.check-item.failed:hover {
  border-color: var(--warning-color);
}

.check-item.testing {
  border-color: var(--primary-color);
  background: rgba(46, 91, 255, 0.05);
}

.check-icon {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background: var(--light-bg);
  display: flex;
  align-items: center;
  justify-content: center;
  margin-right: 16px;
  flex-shrink: 0;
  transition: var(--transition);
}

.check-item.passed .check-icon {
  background: var(--success-color);
  color: white;
}

.check-item.failed .check-icon {
  background: var(--danger-color);
  color: white;
}

.check-item.testing .check-icon {
  background: var(--primary-color);
  color: white;
  animation: pulse 1.5s infinite;
}

@keyframes pulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.05); }
  100% { transform: scale(1); }
}

.check-content {
  flex: 1;
}

.check-title {
  font-weight: 600;
  color: var(--text-primary);
  margin-bottom: 4px;
}

.check-description {
  font-size: 13px;
  color: var(--text-secondary);
}

.check-status {
  font-weight: 600;
  font-size: 14px;
  min-width: 100px;
  text-align: right;
}

.check-item.passed .check-status {
  color: var(--success-color);
}

.check-item.failed .check-status {
  color: var(--danger-color);
}

.check-item.testing .check-status {
  color: var(--primary-color);
}

/* ===== TOAST NOTIFICATIONS ===== */
.toast-container {
  position: fixed;
  top: 20px;
  right: 20px;
  z-index: 9999;
}

.toast {
  background: var(--card-bg);
  border-radius: var(--radius-md);
  padding: 15px 20px;
  margin-bottom: 10px;
  box-shadow: var(--shadow-lg);
  display: flex;
  align-items: center;
  gap: 12px;
  min-width: 300px;
  max-width: 400px;
  animation: slideInRight 0.3s ease;
  border-left: 4px solid var(--primary-color);
}

.toast.success {
  border-left-color: var(--success-color);
}

.toast.error {
  border-left-color: var(--danger-color);
}

.toast.warning {
  border-left-color: var(--warning-color);
}

@keyframes slideInRight {
  from { transform: translateX(100%); opacity: 0; }
  to { transform: translateX(0); opacity: 1; }
}

@keyframes slideOutRight {
  from { transform: translateX(0); opacity: 1; }
  to { transform: translateX(100%); opacity: 0; }
}

.toast-icon {
  font-size: 20px;
}

.toast.success .toast-icon {
  color: var(--success-color);
}

.toast.error .toast-icon {
  color: var(--danger-color);
}

.toast.warning .toast-icon {
  color: var(--warning-color);
}

.toast-content {
  flex: 1;
}

.toast-title {
  font-weight: 600;
  margin-bottom: 4px;
}

.toast-message {
  font-size: 14px;
  color: var(--text-secondary);
}

.toast-close {
  background: none;
  border: none;
  color: var(--text-light);
  cursor: pointer;
  font-size: 18px;
  padding: 0;
  width: 24px;
  height: 24px;
  display: flex;
  align-items: center;
  justify-content: center;
}

/* ===== ACCESS DENIED SCREEN ===== */
.access-denied {
  display: flex;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
  z-index: 10000;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  color: white;
  text-align: center;
  padding: 20px;
}

.access-denied h1 {
  font-size: 2.5em;
  margin-bottom: 20px;
  text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
}

.access-code-input {
  padding: 15px 20px;
  border: none;
  border-radius: var(--radius-md);
  font-size: 16px;
  width: 300px;
  text-align: center;
  margin-bottom: 20px;
  box-shadow: var(--shadow-md);
  color: var(--text-primary);
}

.verify-btn {
  background: white;
  color: var(--primary-color);
  border: none;
  padding: 15px 40px;
  font-size: 16px;
  border-radius: var(--radius-md);
  cursor: pointer;
  font-weight: 600;
  transition: var(--transition);
  box-shadow: var(--shadow-md);
}

.verify-btn:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow-lg);
}

.access-error {
  color: #FFD700;
  margin-top: 15px;
  font-weight: 600;
  display: none;
  background: rgba(255, 0, 0, 0.2);
  padding: 10px 20px;
  border-radius: var(--radius-md);
  animation: shake 0.5s;
}

.github-deployment-info {
  background: rgba(255, 255, 255, 0.1);
  border-radius: var(--radius-lg);
  padding: 20px;
  margin-top: 30px;
  max-width: 500px;
  text-align: left;
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.2);
}

.github-deployment-info h3 {
  color: white;
  margin-bottom: 15px;
  display: flex;
  align-items: center;
  gap: 10px;
}

.github-deployment-info ol {
  margin-left: 20px;
  margin-bottom: 20px;
}

.github-deployment-info li {
  margin-bottom: 10px;
  color: rgba(255, 255, 255, 0.9);
}

.github-deployment-info code {
  background: rgba(0, 0, 0, 0.3);
  padding: 2px 6px;
  border-radius: 4px;
  font-family: monospace;
  color: #FFD700;
}

.github-action-buttons {
  display: flex;
  gap: 10px;
  margin-top: 15px;
}

.github-btn {
  flex: 1;
  padding: 12px;
  border: none;
  border-radius: var(--radius-md);
  font-weight: 600;
  cursor: pointer;
  transition: var(--transition);
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
}

.github-btn-primary {
  background: white;
  color: #24292e;
}

.github-btn-primary:hover {
  background: #f0f0f0;
  transform: translateY(-2px);
}

.github-btn-secondary {
  background: transparent;
  color: white;
  border: 2px solid white;
}

.github-btn-secondary:hover {
  background: rgba(255, 255, 255, 0.1);
  transform: translateY(-2px);
}

@keyframes shake {
  0%, 100% { transform: translateX(0); }
  10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
  20%, 40%, 60%, 80% { transform: translateX(5px); }
}

/* ===== BUTTONS ===== */
.btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: 12px 24px;
  font-size: 16px;
  font-weight: 600;
  border: none;
  border-radius: var(--radius-md);
  cursor: pointer;
  transition: var(--transition);
  gap: 8px;
  outline: none;
}

.btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.btn-primary {
  background: var(--primary-color);
  color: white;
}

.btn-primary:hover:not(:disabled) {
  background: var(--primary-dark);
  transform: translateY(-2px);
  box-shadow: var(--shadow-md);
}

.btn-secondary {
  background: var(--light-bg);
  color: var(--text-primary);
  border: 2px solid var(--border-color);
}

.btn-secondary:hover:not(:disabled) {
  background: var(--border-color);
}

.btn-success {
  background: var(--success-color);
  color: white;
}

.btn-danger {
  background: var(--danger-color);
  color: white;
}

.btn-full {
  width: 100%;
}

/* ===== RESPONSIVE ===== */
@media (max-width: 768px) {
  .system-check-container,
  .microphone-test-box,
  .camera-test-box {
    padding: 20px;
  }
  
  .access-code-input {
    width: 100%;
    max-width: 300px;
  }
  
  .mic-test-controls,
  .camera-controls {
    flex-direction: column;
  }
  
  .access-denied h1 {
    font-size: 2em;
  }
  
  .github-deployment-info {
    margin: 20px;
    padding: 15px;
  }
  
  .github-action-buttons {
    flex-direction: column;
  }
  
  .github-warning {
    width: 95%;
    padding: 12px 15px;
  }
  
  .github-warning-content {
    flex-direction: column;
    text-align: center;
  }
  
  .github-warning-text {
    text-align: center;
  }
  
  .camera-preview-container {
    height: 200px;
  }
}
</style>
</head>

<body>

<!-- GitHub Deployment Warning -->
<div id="githubWarning" class="github-warning" style="display: none;">
  <div class="github-warning-content">
    <div class="github-warning-text">
      <h4><i class="fas fa-exclamation-triangle"></i> Camera/Microphone Access Required</h4>
      <p id="warningMessage">This platform requires camera and microphone access for proctoring.</p>
      <p style="font-size: 12px;">Upload to GitHub Pages to enable these features.</p>
    </div>
    <button id="deployToGitHubBtn" class="github-deploy-btn">
      <i class="fab fa-github"></i> Deploy Now
    </button>
  </div>
</div>

<!-- Microphone Test Modal -->
<div id="microphoneTestModal" class="microphone-test-modal">
  <div class="microphone-test-box">
    <div class="mic-test-header">
      <h3><i class="fas fa-microphone"></i> Microphone Test</h3>
      <p>Please speak to test your microphone</p>
    </div>
    
    <div class="mic-test-visualizer">
      <div id="micLevelIndicator" class="mic-level-indicator"></div>
      <canvas id="micFrequencyCanvas" class="mic-frequency-canvas"></canvas>
    </div>
    
    <div class="mic-volume-display">
      Volume: <span id="micVolumeLevel" class="mic-volume-level">0%</span>
    </div>
    
    <div class="mic-test-controls">
      <button id="startMicTest" class="mic-test-btn">
        <i class="fas fa-play"></i> Start Test
      </button>
      <button id="stopMicTest" class="mic-test-btn" disabled>
        <i class="fas fa-stop"></i> Stop Test
      </button>
    </div>
    
    <div class="mic-troubleshooting">
      <h4><i class="fas fa-tools"></i> Troubleshooting Tips</h4>
      <ul>
        <li>Make sure headphones are properly plugged in</li>
        <li>Check if microphone is muted (look for mute button)</li>
        <li>Speak closer to the microphone</li>
        <li>Ensure browser has microphone permission</li>
        <li>Try unplugging and reconnecting headphones</li>
      </ul>
    </div>
    
    <div id="micDeviceList" class="mic-device-list">
      <h4>Detected Microphones:</h4>
      <div id="deviceItemsContainer"></div>
    </div>
    
    <div class="mic-test-actions">
      <button id="skipMicTest" class="btn btn-secondary btn-full">
        <i class="fas fa-forward"></i> Skip Test
      </button>
      <button id="retryMicTest" class="btn btn-primary btn-full">
        <i class="fas fa-redo"></i> Retry Detection
      </button>
    </div>
  </div>
</div>

<!-- Camera Test Modal -->
<div id="cameraTestModal" class="camera-test-modal">
  <div class="camera-test-box">
    <div class="camera-test-header">
      <h3><i class="fas fa-video"></i> Camera Test</h3>
      <p>Check if your camera is working properly</p>
    </div>
    
    <div class="camera-preview-container">
      <video id="cameraPreview" autoplay playsinline></video>
      <div id="cameraStatus" class="camera-status">Camera off</div>
    </div>
    
    <div class="camera-controls">
      <button id="startCameraTest" class="camera-test-btn">
        <i class="fas fa-play"></i> Start Camera
      </button>
      <button id="stopCameraTest" class="camera-test-btn" disabled>
        <i class="fas fa-stop"></i> Stop Camera
      </button>
    </div>
    
    <div id="cameraDeviceList" class="camera-device-list">
      <h4>Detected Cameras:</h4>
      <div id="cameraItemsContainer"></div>
    </div>
    
    <div class="mic-test-actions">
      <button id="skipCameraTest" class="btn btn-secondary btn-full">
        <i class="fas fa-forward"></i> Skip Test
      </button>
      <button id="retryCameraTest" class="btn btn-primary btn-full">
        <i class="fas fa-redo"></i> Switch Camera
      </button>
    </div>
  </div>
</div>

<!-- Toast Container -->
<div class="toast-container" id="toastContainer"></div>

<!-- Access Denied Screen -->
<div id="accessDenied" class="access-denied">
    <h1>LFJC ONLINE EXAMINATION</h1>
    <p style="font-size: 1.2em; margin: 10px 0;">TOTAL 75 QUESTIONS</p>
    <p style="margin: 5px 0;">• Maths: 20 (MCQ), 5 (Numerical Input)</p>
    <p style="margin: 5px 0;">• Physics: 20 (MCQ), 5 (Numerical Input)</p>
    <p style="margin: 5px 0;">• Chemistry: 20 (MCQ), 5 (Numerical Input)</p>
    <p style="margin: 10px 0; font-weight: bold;">CORRECT ANSWER + 4 MARKS</p>
    <p style="margin: 5px 0; font-weight: bold;">WRONG ANSWER -1 MARK</p>
    
    <input type="password" id="accessCode" class="access-code-input" placeholder="Enter Access Code (lfjc2025)">
    <button id="verifyAccess" class="verify-btn">VERIFY ACCESS</button>
    <div id="accessError" class="access-error">❌ Invalid access code. Please try again.</div>
    
    <!-- GitHub Deployment Instructions -->
    <div class="github-deployment-info">
      <h3><i class="fab fa-github"></i> Deploy on GitHub Pages</h3>
      <ol>
        <li>Create repository on GitHub</li>
        <li>Upload this file as <code>index.html</code></li>
        <li>Go to Settings → Pages → Select "main" branch</li>
        <li>Access via: <code>https://username.github.io/repository/</code></li>
      </ol>
      <div class="github-action-buttons">
        <button id="openGitHubBtn" class="github-btn github-btn-primary">
          <i class="fab fa-github"></i> Create GitHub Repository
        </button>
        <button id="learnMoreBtn" class="github-btn github-btn-secondary">
          <i class="fas fa-book"></i> Learn More
        </button>
      </div>
    </div>
</div>

<!-- System Check Screen -->
<div id="systemCheckScreen">
  <div class="system-check-container">
    <div style="text-align: center; margin-bottom: 30px;">
      <h2 style="color: var(--primary-color); margin-bottom: 10px;">
        <i class="fas fa-shield-alt"></i> System Requirements Check
      </h2>
      <p style="color: var(--text-secondary);">Ensuring your system meets all requirements</p>
    </div>
    
    <div class="checklist">
      <div class="check-item" id="browserCheckItem">
        <div class="check-icon">
          <i class="fas fa-globe"></i>
        </div>
        <div class="check-content">
          <div class="check-title">Web Browser Compatibility</div>
          <div class="check-description">Chrome 80+ recommended for best experience</div>
        </div>
        <div class="check-status">Checking...</div>
      </div>
      
      <div class="check-item" id="deploymentCheckItem">
        <div class="check-icon">
          <i class="fab fa-github"></i>
        </div>
        <div class="check-content">
          <div class="check-title">GitHub Pages Deployment</div>
          <div class="check-description">Required for camera/microphone access</div>
        </div>
        <div class="check-status">Checking...</div>
      </div>
      
      <div class="check-item" id="cameraCheckItem">
        <div class="check-icon">
          <i class="fas fa-video"></i>
        </div>
        <div class="check-content">
          <div class="check-title">Camera Access</div>
          <div class="check-description">Required for identity verification</div>
        </div>
        <div class="check-status">Checking...</div>
      </div>
      
      <div class="check-item" id="micCheckItem">
        <div class="check-icon">
          <i class="fas fa-microphone"></i>
        </div>
        <div class="check-content">
          <div class="check-title">Microphone Access</div>
          <div class="check-description">Required for audio monitoring</div>
        </div>
        <div class="check-status">Checking...</div>
      </div>
      
      <div class="check-item" id="networkCheckItem">
        <div class="check-icon">
          <i class="fas fa-wifi"></i>
        </div>
        <div class="check-content">
          <div class="check-title">Network Stability</div>
          <div class="check-description">Minimum 1 Mbps required</div>
        </div>
        <div class="check-status">Checking...</div>
      </div>
    </div>
    
    <div style="display: flex; gap: 15px; margin-top: 30px;">
      <button id="goBackFromCheck" class="btn btn-secondary" style="flex: 1;">
        <i class="fas fa-arrow-left"></i> Back
      </button>
      <button id="proceedToRegistration" class="btn btn-primary" style="flex: 1;" disabled>
        Continue <i class="fas fa-arrow-right"></i>
      </button>
    </div>
  </div>
</div>

<script>
// ===== GLOBAL VARIABLES =====
let microphoneDetector = null;
let cameraStream = null;
let currentCameraDeviceId = null;

// ===== DEPLOYMENT CHECK FUNCTIONS =====
function checkDeploymentStatus() {
    const isGitHubPages = window.location.hostname.includes('github.io');
    const isHTTPS = window.location.protocol === 'https:';
    const isLocalhost = window.location.hostname === 'localhost' || 
                        window.location.hostname === '127.0.0.1';
    const isFileProtocol = window.location.protocol === 'file:';
    
    console.log('Deployment Status Check:', {
        hostname: window.location.hostname,
        protocol: window.location.protocol,
        isGitHubPages: isGitHubPages,
        isHTTPS: isHTTPS,
        isLocalhost: isLocalhost,
        isFileProtocol: isFileProtocol
    });
    
    if (isGitHubPages) {
        return { 
            type: 'github-pages',
            passed: true,
            message: 'Deployed on GitHub Pages ✓',
            warning: false
        };
    } else if (isHTTPS && !isGitHubPages) {
        return { 
            type: 'https',
            passed: true,
            message: 'Running on HTTPS ✓',
            warning: false
        };
    } else if (isLocalhost) {
        return { 
            type: 'localhost',
            passed: true,
            message: 'Running on local server ✓',
            warning: false
        };
    } else if (isFileProtocol) {
        return { 
            type: 'file-protocol',
            passed: false,
            message: 'Running locally (file://)',
            warning: true
        };
    } else {
        return { 
            type: 'http',
            passed: false,
            message: 'Running on HTTP',
            warning: true
        };
    }
}

function showGitHubWarning() {
    const deploymentStatus = checkDeploymentStatus();
    const warning = document.getElementById('githubWarning');
    const warningMessage = document.getElementById('warningMessage');
    
    if (deploymentStatus.warning) {
        if (deploymentStatus.type === 'file-protocol') {
            warningMessage.innerHTML = '<strong>Local File Issue:</strong> Camera/microphone access requires a web server.<br>Please run this on a local server or deploy to GitHub.';
        } else {
            warningMessage.innerHTML = '<strong>HTTP Issue:</strong> Camera/microphone access requires HTTPS.<br>Upload to GitHub Pages or use HTTPS.';
        }
        
        warning.style.display = 'block';
        
        // Auto-hide after 10 seconds
        setTimeout(() => {
            warning.style.opacity = '0';
            warning.style.transform = 'translate(-50%, -100%)';
            setTimeout(() => {
                warning.style.display = 'none';
            }, 500);
        }, 10000);
    }
}

// ===== TOAST SYSTEM =====
function showToast(message, type = 'info', duration = 5000) {
    const container = document.getElementById('toastContainer');
    if (!container) return;
    
    const toast = document.createElement('div');
    toast.className = `toast ${type}`;
    
    const icons = {
        success: '✅',
        error: '❌',
        warning: '⚠️',
        info: 'ℹ️'
    };
    
    toast.innerHTML = `
        <div class="toast-icon">${icons[type] || icons.info}</div>
        <div class="toast-content">
            <div class="toast-message">${message}</div>
        </div>
        <button class="toast-close">&times;</button>
    `;
    
    container.appendChild(toast);
    
    // Auto remove after duration
    const removeToast = () => {
        toast.style.animation = 'slideOutRight 0.3s ease';
        setTimeout(() => {
            if (toast.parentNode) {
                toast.parentNode.removeChild(toast);
            }
        }, 300);
    };
    
    setTimeout(removeToast, duration);
    
    // Click to close
    toast.querySelector('.toast-close').addEventListener('click', removeToast);
    
    return toast;
}

// ===== MICROPHONE DETECTOR =====
class HeadphoneMicrophoneDetector {
    constructor() {
        this.audioContext = null;
        this.analyser = null;
        this.microphone = null;
        this.audioStream = null;
        this.isTesting = false;
        this.devices = [];
        this.dataArray = null;
        this.animationId = null;
    }
    
    async initialize() {
        try {
            // Check if Web Audio API is supported
            if (!window.AudioContext && !window.webkitAudioContext) {
                throw new Error('Web Audio API not supported');
            }
            
            window.AudioContext = window.AudioContext || window.webkitAudioContext;
            this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
            
            if (this.audioContext.state === 'suspended') {
                await this.audioContext.resume();
            }
            
            return true;
        } catch (error) {
            console.error('Audio context initialization failed:', error);
            showToast(`Audio API error: ${error.message}`, 'error');
            return false;
        }
    }
    
    async detectAllAudioDevices() {
        try {
            // Check deployment status first
            const deploymentStatus = checkDeploymentStatus();
            if (!deploymentStatus.passed) {
                throw new Error(`Camera/microphone access requires HTTPS or localhost. Current: ${deploymentStatus.type}`);
            }
            
            // Check if media devices API is available
            if (!navigator.mediaDevices || !navigator.mediaDevices.enumerateDevices) {
                throw new Error('Media Devices API not supported');
            }
            
            // First get permission by trying to access microphone
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                // Stop the stream immediately after getting permission
                stream.getTracks().forEach(track => track.stop());
            } catch (permissionError) {
                console.warn('Permission request failed:', permissionError);
            }
            
            // Now enumerate devices
            const allDevices = await navigator.mediaDevices.enumerateDevices();
            console.log('All devices found:', allDevices);
            
            // Filter for audio input devices with labels (labels only appear after permission)
            this.devices = allDevices.filter(device => 
                device.kind === 'audioinput' && 
                device.deviceId && 
                device.deviceId !== 'default'
            );
            
            console.log('Audio input devices:', this.devices);
            
            this.displayDevices();
            return this.devices;
        } catch (error) {
            console.error('Device enumeration failed:', error);
            showToast(`Microphone detection failed: ${error.message}`, 'error');
            this.devices = [];
            return [];
        }
    }
    
    displayDevices() {
        const container = document.getElementById('deviceItemsContainer');
        const deviceList = document.getElementById('micDeviceList');
        
        if (!container) return;
        
        if (this.devices.length === 0) {
            deviceList.style.display = 'block';
            container.innerHTML = `
                <div class="device-item">
                    <div class="device-label">
                        <i class="fas fa-exclamation-triangle"></i> No microphones detected
                    </div>
                    <div class="device-id">
                        Check connections and browser permissions
                    </div>
                </div>
            `;
            return;
        }
        
        container.innerHTML = '';
        this.devices.forEach((device, index) => {
            const deviceItem = document.createElement('div');
            deviceItem.className = 'device-item';
            deviceItem.dataset.deviceId = device.deviceId;
            
            const isHeadset = this.isLikelyHeadset(device.label || '');
            const headsetIcon = isHeadset ? '<i class="fas fa-headphones"></i>' : '<i class="fas fa-microphone"></i>';
            const deviceName = device.label || `Microphone ${index + 1}`;
            
            deviceItem.innerHTML = `
                <div class="device-label">
                    ${headsetIcon} ${deviceName}
                </div>
                <div class="device-id">
                    ${device.deviceId.substring(0, 40)}...
                </div>
            `;
            
            // Click to select and test this device
            deviceItem.addEventListener('click', () => {
                document.querySelectorAll('.device-item').forEach(item => {
                    item.style.background = '';
                });
                deviceItem.style.background = 'rgba(46, 91, 255, 0.1)';
                this.startTest(device.deviceId);
            });
            
            container.appendChild(deviceItem);
        });
    }
    
    isLikelyHeadset(label) {
        if (!label) return false;
        
        const headsetKeywords = [
            'headset', 'headphone', 'earphone', 'headphones', 
            'usb audio', 'bluetooth', 'wireless', 'gaming',
            'logitech', 'hyperx', 'razer', 'steelseries',
            'sony', 'bose', 'jbl', 'sennheiser', 'audio-technica'
        ];
        
        const lowerLabel = label.toLowerCase();
        return headsetKeywords.some(keyword => lowerLabel.includes(keyword));
    }
    
    async startTest(deviceId = null) {
        try {
            this.stopTest();
            
            if (!this.audioContext) {
                await this.initialize();
                if (!this.audioContext) return false;
            }
            
            console.log('Starting microphone test with device:', deviceId);
            
            const constraints = {
                audio: {
                    deviceId: deviceId ? { exact: deviceId } : undefined,
                    echoCancellation: false,
                    noiseSuppression: false,
                    autoGainControl: false,
                    channelCount: 1,
                    sampleRate: 44100
                }
            };
            
            // If no deviceId specified, let browser choose
            if (!deviceId) {
                constraints.audio = true;
            }
            
            this.audioStream = await navigator.mediaDevices.getUserMedia(constraints);
            console.log('Got audio stream:', this.audioStream);
            
            this.setupAudioAnalysis();
            this.startVisualization();
            
            this.isTesting = true;
            
            // Update UI
            document.getElementById('startMicTest').disabled = true;
            document.getElementById('stopMicTest').disabled = false;
            
            showToast('Microphone test started. Speak into your microphone.', 'success');
            return true;
            
        } catch (error) {
            console.error('Microphone test failed:', error);
            
            let errorMsg = 'Failed to access microphone. ';
            if (error.name === 'NotAllowedError') {
                errorMsg += 'Permission denied. Please allow microphone access in your browser.';
            } else if (error.name === 'NotFoundError') {
                errorMsg += 'No microphone found. Please connect a microphone.';
            } else if (error.name === 'NotReadableError') {
                errorMsg += 'Microphone is already in use by another application.';
            } else {
                errorMsg += error.message;
            }
            
            showToast(errorMsg, 'error');
            return false;
        }
    }
    
    setupAudioAnalysis() {
        if (!this.audioStream || !this.audioContext) return;
        
        this.analyser = this.audioContext.createAnalyser();
        this.analyser.fftSize = 256;
        this.analyser.smoothingTimeConstant = 0.8;
        
        this.microphone = this.audioContext.createMediaStreamSource(this.audioStream);
        this.microphone.connect(this.analyser);
        
        this.dataArray = new Uint8Array(this.analyser.frequencyBinCount);
        
        // Also connect to destination to avoid Chrome security warning
        this.analyser.connect(this.audioContext.destination);
    }
    
    startVisualization() {
        const canvas = document.getElementById('micFrequencyCanvas');
        const ctx = canvas.getContext('2d');
        const levelBar = document.getElementById('micLevelIndicator');
        const volumeDisplay = document.getElementById('micVolumeLevel');
        
        canvas.width = canvas.offsetWidth;
        canvas.height = canvas.offsetHeight;
        
        const draw = () => {
            if (!this.isTesting || !this.analyser || !this.dataArray) {
                return;
            }
            
            this.animationId = requestAnimationFrame(draw);
            
            this.analyser.getByteFrequencyData(this.dataArray);
            
            let sum = 0;
            for (let i = 0; i < this.dataArray.length; i++) {
                sum += this.dataArray[i];
            }
            const average = sum / this.dataArray.length;
            const volume = average / 255;
            
            if (volumeDisplay) {
                const percent = Math.round(volume * 100);
                volumeDisplay.textContent = `${percent}%`;
                
                if (volume > 0.1) {
                    volumeDisplay.style.color = '#36B37E'; // Green for good volume
                } else if (volume > 0.05) {
                    volumeDisplay.style.color = '#FFAB00'; // Yellow for medium
                } else if (volume > 0.02) {
                    volumeDisplay.style.color = '#FF5630'; // Red for low
                } else {
                    volumeDisplay.style.color = '#B0BAC9'; // Gray for no sound
                }
            }
            
            if (levelBar) {
                const heightPercent = Math.min(volume * 300, 100);
                levelBar.style.height = `${heightPercent}%`;
                
                if (volume > 0.1) {
                    levelBar.style.background = 'linear-gradient(to top, #36B37E, #00C9A7)';
                } else if (volume > 0.05) {
                    levelBar.style.background = 'linear-gradient(to top, #FFAB00, #FFC400)';
                } else if (volume > 0.02) {
                    levelBar.style.background = 'linear-gradient(to top, #FF5630, #FF7452)';
                } else {
                    levelBar.style.background = 'linear-gradient(to top, #B0BAC9, #DFE1E6)';
                }
            }
            
            this.drawFrequencyBars(ctx, canvas.width, canvas.height);
        };
        
        draw();
    }
    
    drawFrequencyBars(ctx, width, height) {
        if (!this.dataArray) return;
        
        ctx.clearRect(0, 0, width, height);
        
        const barWidth = (width / this.dataArray.length) * 2.5;
        let x = 0;
        
        for (let i = 0; i < this.dataArray.length; i++) {
            const barHeight = (this.dataArray[i] / 255) * height;
            
            const gradient = ctx.createLinearGradient(0, height - barHeight, 0, height);
            
            if (barHeight > height * 0.7) {
                gradient.addColorStop(0, '#36B37E');
                gradient.addColorStop(1, '#00C9A7');
            } else if (barHeight > height * 0.4) {
                gradient.addColorStop(0, '#FFAB00');
                gradient.addColorStop(1, '#FFC400');
            } else {
                gradient.addColorStop(0, '#2E5BFF');
                gradient.addColorStop(1, '#8A2BE2');
            }
            
            ctx.fillStyle = gradient;
            ctx.fillRect(x, height - barHeight, barWidth, barHeight);
            
            x += barWidth + 1;
        }
    }
    
    stopTest() {
        this.isTesting = false;
        
        if (this.animationId) {
            cancelAnimationFrame(this.animationId);
            this.animationId = null;
        }
        
        if (this.audioStream) {
            this.audioStream.getTracks().forEach(track => {
                track.stop();
                track.enabled = false;
            });
            this.audioStream = null;
        }
        
        if (this.microphone) {
            this.microphone.disconnect();
            this.microphone = null;
        }
        
        if (this.analyser) {
            this.analyser.disconnect();
            this.analyser = null;
        }
        
        const canvas = document.getElementById('micFrequencyCanvas');
        if (canvas) {
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        }
        
        const levelBar = document.getElementById('micLevelIndicator');
        if (levelBar) {
            levelBar.style.height = '0%';
        }
        
        const volumeDisplay = document.getElementById('micVolumeLevel');
        if (volumeDisplay) {
            volumeDisplay.textContent = '0%';
            volumeDisplay.style.color = '#B0BAC9';
        }
        
        // Reset buttons
        const startBtn = document.getElementById('startMicTest');
        const stopBtn = document.getElementById('stopMicTest');
        if (startBtn) startBtn.disabled = false;
        if (stopBtn) stopBtn.disabled = true;
    }
    
    cleanup() {
        this.stopTest();
        
        if (this.audioContext) {
            this.audioContext.close().then(() => {
                this.audioContext = null;
            }).catch(console.error);
        }
    }
}

// ===== CAMERA FUNCTIONS =====
async function detectAllCameras() {
    try {
        const deploymentStatus = checkDeploymentStatus();
        if (!deploymentStatus.passed) {
            throw new Error(`Camera access requires HTTPS or localhost. Current: ${deploymentStatus.type}`);
        }
        
        if (!navigator.mediaDevices || !navigator.mediaDevices.enumerateDevices) {
            throw new Error('Media Devices API not supported');
        }
        
        // First get permission by trying to access camera
        try {
            const stream = await navigator.mediaDevices.getUserMedia({ video: true });
            stream.getTracks().forEach(track => track.stop());
        } catch (permissionError) {
            console.warn('Camera permission request failed:', permissionError);
        }
        
        // Now enumerate devices
        const allDevices = await navigator.mediaDevices.enumerateDevices();
        const cameras = allDevices.filter(device => 
            device.kind === 'videoinput' && 
            device.deviceId && 
            device.deviceId !== 'default'
        );
        
        console.log('Cameras found:', cameras);
        displayCameras(cameras);
        
        return cameras;
    } catch (error) {
        console.error('Camera detection failed:', error);
        showToast(`Camera detection failed: ${error.message}`, 'error');
        return [];
    }
}

function displayCameras(cameras) {
    const container = document.getElementById('cameraItemsContainer');
    const deviceList = document.getElementById('cameraDeviceList');
    
    if (!container) return;
    
    if (cameras.length === 0) {
        deviceList.style.display = 'block';
        container.innerHTML = `
            <div class="camera-device-item">
                <div class="device-label">
                    <i class="fas fa-exclamation-triangle"></i> No cameras detected
                </div>
                <div class="device-id">
                    Check connections and browser permissions
                </div>
            </div>
        `;
        return;
    }
    
    container.innerHTML = '';
    cameras.forEach((camera, index) => {
        const cameraItem = document.createElement('div');
        cameraItem.className = 'camera-device-item';
        cameraItem.dataset.deviceId = camera.deviceId;
        
        const cameraName = camera.label || `Camera ${index + 1}`;
        
        cameraItem.innerHTML = `
            <div class="device-label">
                <i class="fas fa-video"></i> ${cameraName}
            </div>
            <div class="device-id">
                ${camera.deviceId.substring(0, 40)}...
            </div>
        `;
        
        cameraItem.addEventListener('click', () => {
            document.querySelectorAll('.camera-device-item').forEach(item => {
                item.style.background = '';
            });
            cameraItem.style.background = 'rgba(46, 91, 255, 0.1)';
            startCameraTest(camera.deviceId);
        });
        
        container.appendChild(cameraItem);
    });
}

async function startCameraTest(deviceId = null) {
    try {
        stopCameraTest();
        
        console.log('Starting camera test with device:', deviceId);
        
        const constraints = {
            video: {
                deviceId: deviceId ? { exact: deviceId } : undefined,
                width: { ideal: 1280 },
                height: { ideal: 720 },
                facingMode: 'user'
            }
        };
        
        if (!deviceId) {
            constraints.video = true;
        }
        
        cameraStream = await navigator.mediaDevices.getUserMedia(constraints);
        currentCameraDeviceId = deviceId;
        
        const videoElement = document.getElementById('cameraPreview');
        const statusElement = document.getElementById('cameraStatus');
        
        videoElement.srcObject = cameraStream;
        statusElement.textContent = 'Camera on';
        
        // Update UI
        document.getElementById('startCameraTest').disabled = true;
        document.getElementById('stopCameraTest').disabled = false;
        
        showToast('Camera test started.', 'success');
        return true;
        
    } catch (error) {
        console.error('Camera test failed:', error);
        
        let errorMsg = 'Failed to access camera. ';
        if (error.name === 'NotAllowedError') {
            errorMsg += 'Permission denied. Please allow camera access in your browser.';
        } else if (error.name === 'NotFoundError') {
            errorMsg += 'No camera found. Please connect a camera.';
        } else if (error.name === 'NotReadableError') {
            errorMsg += 'Camera is already in use by another application.';
        } else {
            errorMsg += error.message;
        }
        
        showToast(errorMsg, 'error');
        return false;
    }
}

function stopCameraTest() {
    if (cameraStream) {
        cameraStream.getTracks().forEach(track => {
            track.stop();
            track.enabled = false;
        });
        cameraStream = null;
    }
    
    const videoElement = document.getElementById('cameraPreview');
    if (videoElement) {
        videoElement.srcObject = null;
    }
    
    const statusElement = document.getElementById('cameraStatus');
    if (statusElement) {
        statusElement.textContent = 'Camera off';
    }
    
    // Reset buttons
    const startBtn = document.getElementById('startCameraTest');
    const stopBtn = document.getElementById('stopCameraTest');
    if (startBtn) startBtn.disabled = false;
    if (stopBtn) stopBtn.disabled = true;
}

// ===== SYSTEM CHECK FUNCTIONS =====
async function runSystemChecks() {
    console.log('Running system checks...');
    
    const checks = [
        { id: 'browserCheckItem', test: checkBrowserCompatibility },
        { id: 'deploymentCheckItem', test: checkDeployment },
        { id: 'cameraCheckItem', test: checkCameraAccess },
        { id: 'micCheckItem', test: checkMicrophoneAccess },
        { id: 'networkCheckItem', test: checkNetworkStability }
    ];
    
    let allPassed = true;
    
    for (let i = 0; i < checks.length; i++) {
        const check = checks[i];
        const element = document.getElementById(check.id);
        const status = element.querySelector('.check-status');
        
        element.classList.remove('passed', 'failed');
        element.classList.add('testing');
        status.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Testing...';
        
        try {
            const result = await check.test();
            
            if (result.passed) {
                element.classList.remove('testing');
                element.classList.add('passed');
                status.innerHTML = '<i class="fas fa-check-circle"></i> Passed';
                
                if (result.message) {
                    element.querySelector('.check-description').textContent = result.message;
                }
            } else {
                element.classList.remove('testing');
                element.classList.add('failed');
                status.innerHTML = '<i class="fas fa-times-circle"></i> Failed';
                allPassed = false;
                
                if (result.message) {
                    element.querySelector('.check-description').textContent = result.message;
                }
            }
        } catch (error) {
            console.error(`Check ${check.id} failed:`, error);
            element.classList.remove('testing');
            element.classList.add('failed');
            status.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Error';
            element.querySelector('.check-description').textContent = error.message || 'Check failed';
            allPassed = false;
        }
        
        // Small delay between checks for better UX
        if (i < checks.length - 1) {
            await new Promise(resolve => setTimeout(resolve, 800));
        }
    }
    
    const proceedBtn = document.getElementById('proceedToRegistration');
    if (proceedBtn) {
        proceedBtn.disabled = !allPassed;
        if (!allPassed) {
            proceedBtn.title = 'Fix all checks to continue';
        }
    }
    
    return allPassed;
}

async function checkBrowserCompatibility() {
    const isChrome = /chrome|chromium|crios/i.test(navigator.userAgent);
    const versionMatch = navigator.userAgent.match(/(chrome|chromium|crios)\/(\d+)/i);
    const version = versionMatch ? parseInt(versionMatch[2]) : 0;
    const isFirefox = /firefox|fxios/i.test(navigator.userAgent);
    const isEdge = /edg/i.test(navigator.userAgent);
    
    let message = '';
    let passed = false;
    
    if (isChrome) {
        passed = version >= 80;
        message = `Chrome ${version} ${passed ? '✓' : '(Update to 80+)'}`;
    } else if (isFirefox) {
        passed = true;
        message = 'Firefox (supported)';
    } else if (isEdge) {
        passed = true;
        message = 'Edge (supported)';
    } else {
        passed = false;
        message = 'Use Chrome 80+, Firefox, or Edge';
    }
    
    return { passed, message };
}

async function checkDeployment() {
    const deploymentStatus = checkDeploymentStatus();
    
    return {
        passed: deploymentStatus.passed,
        message: deploymentStatus.message
    };
}

async function checkCameraAccess() {
    try {
        const deploymentStatus = checkDeploymentStatus();
        
        if (!deploymentStatus.passed) {
            return { 
                passed: false, 
                message: 'Deploy to GitHub Pages or use HTTPS/localhost' 
            };
        }
        
        if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
            return { passed: false, message: 'Camera API not supported' };
        }
        
        // Quick test with simple constraints
        const stream = await navigator.mediaDevices.getUserMedia({ 
            video: { width: { ideal: 640 }, height: { ideal: 480 } } 
        });
        
        // Get camera info
        const videoTrack = stream.getVideoTracks()[0];
        const settings = videoTrack.getSettings();
        
        stream.getTracks().forEach(track => track.stop());
        
        return { 
            passed: true, 
            message: `Camera ready (${settings.width || 640}x${settings.height || 480})` 
        };
    } catch (error) {
        console.error('Camera check failed:', error);
        let message = 'Camera access failed';
        if (error.name === 'NotFoundError') message = 'No camera found';
        if (error.name === 'NotAllowedError') message = 'Permission denied';
        
        return { passed: false, message };
    }
}

async function checkMicrophoneAccess() {
    try {
        const deploymentStatus = checkDeploymentStatus();
        
        if (!deploymentStatus.passed) {
            return { 
                passed: false, 
                message: 'Deploy to GitHub Pages or use HTTPS/localhost'
            };
        }
        
        if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
            return { passed: false, message: 'Microphone API not supported' };
        }
        
        // Create detector instance
        microphoneDetector = new HeadphoneMicrophoneDetector();
        
        // Try to get devices
        const devices = await microphoneDetector.detectAllAudioDevices();
        
        if (devices.length === 0) {
            microphoneDetector.cleanup();
            return { 
                passed: false, 
                message: 'No microphone detected'
            };
        }
        
        // Quick test
        const testResult = await microphoneDetector.testAllDevices();
        
        if (testResult.success) {
            microphoneDetector.cleanup();
            const deviceName = testResult.device?.label || 'Microphone';
            return { 
                passed: true, 
                message: `${deviceName.substring(0, 30)}... ✓`
            };
        } else {
            microphoneDetector.cleanup();
            return { 
                passed: false, 
                message: 'Microphone not working'
            };
        }
        
    } catch (error) {
        console.error('Microphone check failed:', error);
        let message = 'Microphone check failed';
        if (error.name === 'NotAllowedError') message = 'Permission denied';
        if (error.name === 'NotFoundError') message = 'No microphone found';
        
        return { 
            passed: false, 
            message
        };
    }
}

async function checkNetworkStability() {
    if (!navigator.onLine) {
        return { passed: false, message: 'No internet connection' };
    }
    
    // Simple network check
    return new Promise((resolve) => {
        const startTime = Date.now();
        const img = new Image();
        
        // Use a small image that should always be available
        img.src = 'https://www.google.com/images/branding/googlelogo/2x/googlelogo_color_92x30dp.png?t=' + Date.now();
        
        img.onload = () => {
            const latency = Date.now() - startTime;
            const passed = latency < 2000; // 2 second timeout
            resolve({
                passed,
                message: passed ? `Connected (${latency}ms)` : 'Slow connection'
            });
        };
        
        img.onerror = () => {
            resolve({
                passed: true, // Still pass if image fails but we're online
                message: 'Network connected'
            });
        };
        
        // Timeout after 3 seconds
        setTimeout(() => {
            if (!img.complete) {
                resolve({
                    passed: true, // Network might be slow but connected
                    message: 'Network timeout (slow)'
                });
            }
        }, 3000);
    });
}

// ===== MODAL FUNCTIONS =====
function showMicrophoneTestModal() {
    const modal = document.getElementById('microphoneTestModal');
    if (!modal) return;
    
    modal.style.display = 'flex';
    
    if (!microphoneDetector) {
        microphoneDetector = new HeadphoneMicrophoneDetector();
    }
    
    // Setup event listeners for microphone modal
    document.getElementById('startMicTest').onclick = async () => {
        try {
            const success = await microphoneDetector.startTest();
            if (!success) {
                document.getElementById('startMicTest').disabled = false;
                document.getElementById('stopMicTest').disabled = true;
            }
        } catch (error) {
            console.error('Failed to start microphone test:', error);
            showToast('Failed to start test: ' + error.message, 'error');
            document.getElementById('startMicTest').disabled = false;
            document.getElementById('stopMicTest').disabled = true;
        }
    };
    
    document.getElementById('stopMicTest').onclick = () => {
        microphoneDetector.stopTest();
        showToast('Microphone test stopped', 'info');
    };
    
    document.getElementById('skipMicTest').onclick = () => {
        if (microphoneDetector) {
            microphoneDetector.cleanup();
        }
        
        modal.style.display = 'none';
        
        const micItem = document.getElementById('micCheckItem');
        if (micItem) {
            const status = micItem.querySelector('.check-status');
            micItem.classList.remove('failed', 'testing');
            micItem.classList.add('failed');
            status.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Skipped';
            micItem.querySelector('.check-description').textContent = 'Audio monitoring disabled';
        }
        
        showToast('Microphone test skipped. Audio monitoring disabled.', 'warning');
        checkAllPassed();
    };
    
    document.getElementById('retryMicTest').onclick = async () => {
        showToast('Retrying microphone detection...', 'info');
        
        if (microphoneDetector) {
            microphoneDetector.cleanup();
        }
        
        microphoneDetector = new HeadphoneMicrophoneDetector();
        
        try {
            const devices = await microphoneDetector.detectAllAudioDevices();
            
            if (devices.length > 0) {
                showToast(`${devices.length} microphone(s) detected`, 'success');
            } else {
                showToast('Still no microphone detected', 'error');
            }
        } catch (error) {
            showToast('Detection failed: ' + error.message, 'error');
        }
    };
    
    // Close modal when clicking outside
    modal.addEventListener('click', (e) => {
        if (e.target === modal) {
            modal.style.display = 'none';
        }
    });
    
    // Load devices when modal opens
    setTimeout(() => {
        if (microphoneDetector) {
            microphoneDetector.detectAllAudioDevices();
        }
    }, 100);
}

function showCameraTestModal() {
    const modal = document.getElementById('cameraTestModal');
    if (!modal) return;
    
    modal.style.display = 'flex';
    
    // Setup event listeners for camera modal
    document.getElementById('startCameraTest').onclick = async () => {
        try {
            const success = await startCameraTest();
            if (!success) {
                document.getElementById('startCameraTest').disabled = false;
                document.getElementById('stopCameraTest').disabled = true;
            }
        } catch (error) {
            console.error('Failed to start camera test:', error);
            showToast('Failed to start test: ' + error.message, 'error');
            document.getElementById('startCameraTest').disabled = false;
            document.getElementById('stopCameraTest').disabled = true;
        }
    };
    
    document.getElementById('stopCameraTest').onclick = () => {
        stopCameraTest();
        showToast('Camera test stopped', 'info');
    };
    
    document.getElementById('skipCameraTest').onclick = () => {
        stopCameraTest();
        modal.style.display = 'none';
        
        const cameraItem = document.getElementById('cameraCheckItem');
        if (cameraItem) {
            const status = cameraItem.querySelector('.check-status');
            cameraItem.classList.remove('failed', 'testing');
            cameraItem.classList.add('failed');
            status.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Skipped';
            cameraItem.querySelector('.check-description').textContent = 'Video monitoring disabled';
        }
        
        showToast('Camera test skipped. Video monitoring disabled.', 'warning');
        checkAllPassed();
    };
    
    document.getElementById('retryCameraTest').onclick = async () => {
        showToast('Retrying camera detection...', 'info');
        stopCameraTest();
        
        try {
            const cameras = await detectAllCameras();
            
            if (cameras.length > 0) {
                showToast(`${cameras.length} camera(s) detected`, 'success');
            } else {
                showToast('Still no camera detected', 'error');
            }
        } catch (error) {
            showToast('Detection failed: ' + error.message, 'error');
        }
    };
    
    // Close modal when clicking outside
    modal.addEventListener('click', (e) => {
        if (e.target === modal) {
            modal.style.display = 'none';
        }
    });
    
    // Load cameras when modal opens
    setTimeout(() => {
        detectAllCameras();
    }, 100);
}

function checkAllPassed() {
    const allChecks = document.querySelectorAll('.check-item');
    let allPassed = true;
    
    allChecks.forEach(check => {
        if (!check.classList.contains('passed')) {
            allPassed = false;
        }
    });
    
    const proceedBtn = document.getElementById('proceedToRegistration');
    if (proceedBtn) {
        proceedBtn.disabled = !allPassed;
    }
    
    return allPassed;
}

// ===== ACCESS CODE VERIFICATION =====
function verifyAccessCode() {
    const accessCode = document.getElementById('accessCode').value.trim();
    const errorElement = document.getElementById('accessError');
    const ACCESS_CODE = "lfjc2025";
    
    if (errorElement) errorElement.style.display = 'none';
    
    if (accessCode === ACCESS_CODE) {
        document.getElementById('accessDenied').style.display = 'none';
        document.getElementById('systemCheckScreen').style.display = 'block';
        
        setTimeout(() => runSystemChecks(), 500);
        
        showToast('Access granted! Running system checks...', 'success');
    } else {
        if (errorElement) errorElement.style.display = 'block';
        
        const accessDenied = document.getElementById('accessDenied');
        if (accessDenied) {
            accessDenied.style.animation = 'none';
            setTimeout(() => {
                accessDenied.style.animation = 'shake 0.5s';
            }, 10);
        }
        
        const accessCodeInput = document.getElementById('accessCode');
        if (accessCodeInput) {
            accessCodeInput.value = '';
            accessCodeInput.focus();
        }
    }
}

// ===== INITIALIZATION =====
document.addEventListener('DOMContentLoaded', function() {
    console.log('LFJC Examination Platform Loaded');
    
    // Check deployment status
    const deploymentStatus = checkDeploymentStatus();
    console.log('Deployment status:', deploymentStatus);
    
    // Show warning if not properly deployed
    if (deploymentStatus.warning) {
        showGitHubWarning();
    }
    
    // Setup access code verification
    const accessCodeInput = document.getElementById('accessCode');
    const verifyBtn = document.getElementById('verifyAccess');
    
    if (accessCodeInput) {
        accessCodeInput.focus();
        
        accessCodeInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                verifyAccessCode();
            }
        });
    }
    
    if (verifyBtn) {
        verifyBtn.addEventListener('click', verifyAccessCode);
    }
    
    // Setup system check navigation
    const goBackBtn = document.getElementById('goBackFromCheck');
    if (goBackBtn) {
        goBackBtn.addEventListener('click', function() {
            document.getElementById('systemCheckScreen').style.display = 'none';
            document.getElementById('accessDenied').style.display = 'flex';
            if (accessCodeInput) accessCodeInput.focus();
        });
    }
    
    // Setup proceed button
    const proceedBtn = document.getElementById('proceedToRegistration');
    if (proceedBtn) {
        proceedBtn.addEventListener('click', function() {
            showToast('Proceeding to registration...', 'success');
            // Add your registration logic here
        });
    }
    
    // Make check items clickable
    document.getElementById('cameraCheckItem').addEventListener('click', function() {
        if (this.classList.contains('failed')) {
            showCameraTestModal();
        }
    });
    
    document.getElementById('micCheckItem').addEventListener('click', function() {
        if (this.classList.contains('failed')) {
            showMicrophoneTestModal();
        }
    });
    
    // GitHub deployment buttons
    const deployButtons = ['deployToGitHubBtn', 'openGitHubBtn'];
    deployButtons.forEach(btnId => {
        const btn = document.getElementById(btnId);
        if (btn) {
            btn.addEventListener('click', function() {
                window.open('https://github.com/new', '_blank');
            });
        }
    });
    
    // Learn more button
    const learnMoreBtn = document.getElementById('learnMoreBtn');
    if (learnMoreBtn) {
        learnMoreBtn.addEventListener('click', function() {
            window.open('https://pages.github.com', '_blank');
        });
    }
    
    // Cleanup on page unload
    window.addEventListener('beforeunload', function() {
        if (microphoneDetector) {
            microphoneDetector.cleanup();
        }
        stopCameraTest();
    });
    
    // Show instructions for local file protocol
    if (deploymentStatus.type === 'file-protocol') {
        showToast('⚠️ Run this file on a local server for camera/microphone access. Use: python -m http.server 8000', 'warning', 10000);
    }
});

// ===== UTILITY FUNCTIONS =====
function getBrowserInfo() {
    const ua = navigator.userAgent;
    let browser = "Unknown";
    let version = "Unknown";
    
    // Chrome
    if (ua.indexOf("Chrome") > -1) {
        browser = "Chrome";
        const match = ua.match(/Chrome\/(\d+)/);
        version = match ? match[1] : "Unknown";
    }
    // Firefox
    else if (ua.indexOf("Firefox") > -1) {
        browser = "Firefox";
        const match = ua.match(/Firefox\/(\d+)/);
        version = match ? match[1] : "Unknown";
    }
    // Safari
    else if (ua.indexOf("Safari") > -1) {
        browser = "Safari";
        const match = ua.match(/Version\/(\d+)/);
        version = match ? match[1] : "Unknown";
    }
    // Edge
    else if (ua.indexOf("Edge") > -1) {
        browser = "Edge";
        const match = ua.match(/Edge\/(\d+)/);
        version = match ? match[1] : "Unknown";
    }
    
    return { browser, version };
}

// Log browser info for debugging
console.log('Browser Info:', getBrowserInfo());
console.log('Platform:', navigator.platform);
console.log('User Agent:', navigator.userAgent);
</script>
</body>
</html>
